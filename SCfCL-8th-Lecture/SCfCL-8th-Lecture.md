---
marp: true
math: katex
paginate: true
---
<!-- スライドURL：https://docs.google.com/presentation/d/1en3iGS3B-GlsSBFECzfODm5qjF3iIN72v04S5zuJzcw/edit?usp=sharing --->

# コンピュータリテラシ発展 〜Pythonを学ぶ〜

## 第8回：Excel作業の前工程・後工程の自動化」

情報学部 情報学科 情報メディア専攻
清水 哲也 ( shimizu@info.shonan-it.ac.jp )

---

# 今回の授業内容

---

# 今回の授業内容

- 前回の課題解説
- フォルダ・ファイル操作
- 課題

---

# 前回の課題解説

---

# 前回の課題解説

- 前回の課題の解答例を示します
- 解答例について質問があればご連絡ください

## 解答例

（あとでURLを貼り付ける）

---

# フォルダ・ファイル操作

---

# 絶対パスと相対パス

プログラムで外部ファイルを操作する際には，**場所に関する情報**を指定する必要があります

指定方法は2つあります
- **絶対パス**：絶対的な位置の記述（例：住所）
- **相対パス**：今自分がいる場所を起点にした位置の記述（例：道案内）

---

# 絶対パスと相対パス（絶対パスについて）

- OS(コンピュータ)で自分がいる場所に関する情報はツリー構造
- ツリー構造の基準
  - WindowsならCドライブ
  - LinuxやMacならルート（root）
- 基準から目的のファイルやフォルダまでのパスを記述するのが**絶対パス**

---

# 絶対パスと相対パス（絶対パスについて）

（絶対パスを解説する図を挿入）

---

# 絶対パスと相対パス（相対パスについて）

- 自分が現在操作しているフォルダをピリオド1つ「**.**」で表します
- 1つ上の階層のフォルダならピリオド２つ「**..**」で表します

---

# 絶対パスと相対パス（相対パスについて）

（絶対パスを解説する図を挿入）

---

# フォルダにあるファイルを一覧表示する

- 現在のフォルダの場所を確認します
- `os` モジュールをインポート
  - フォルダやファイルの操作などOSに依存しているさまざまな機能が備わっているモジュールです
- `getcwd()`関数
  - 現在自分がいるフォルダ（カレントディレクトリ）を絶対パスで表示
  - **get** **c**urrent **w**orking **d**irectoryの略

---

# フォルダにあるファイルを一覧表示する

- 現在のフォルダの場所を確認します
- Colabで実行するので「**￥**」ではなく「**/**」で表示されます

```py
import os

path = os.getcwd()
print(path)
```

---

# フォルダにあるファイルを一覧表示する

- 現在のフォルダにあるファイルの一覧を表示
- `listdir()`関数
  - 特定フォルダ内にあるファイルを一覧表示する関数
  - 引数はファイルを表示したいディレクトリ（フォルダ）のパス

---

# フォルダにあるファイルを一覧表示する

- 現在のフォルダにあるファイルの一覧を表示します
- 今自分がいるフォルダのファイルを一覧表示します

```py
import os # osモジュールは一度インポートしていれば再度書かかなくてもよい

path = os.getcwd()
files = os.listdir(path)

print(files)
```

---

# フォルダにあるファイルを一覧表示する

- 現在のフォルダにあるファイルの一覧を表示します
- Google Driveをマウントしてください
- 授業用フォルダ内のファイルを一覧表示します

```py
import os

# Google Driveをマウントして授業用フォルダのpathを書いてください
path = '/content/drive/MyDrive/???'
files = os.listdir(path)

print(files)
```

---

# フォルダにあるファイルを一覧表示する

- 相対パスを使ってファイルを一覧表示させます
- ColabはLinux系なので「**¥**」ではなく「**/**」を使います
- 一つ上のフォルダにあるファイルを一覧表示させます
  - パスには「`../`」を指定します

---

# フォルダにあるファイルを一覧表示する

- 相対パスを使ってファイルを一覧表示させます
- 一つ上のフォルダにあるファイルを一覧表示させます

```py
import os

path = '../'
files = os.listdir(path)

print(files)
```

---

# フォルダにあるファイルを一覧表示する

- 再帰的にフォルダの中身を表示します
- 出力結果の中にあるフォルダ（サブフォルダ）の中身を表示します
- `glob`モジュール
  - 再帰的なファイル検索を実行
  - 高度な検索が可能
- **再帰的**とは
  - 自己の行為の結果が自己に戻ってくること

---

# フォルダにあるファイルを一覧表示する

- 再帰的にフォルダの中身を表示します
- 出力結果の中にあるフォルダ（サブフォルダ）の中身を表示します
- 表示を見やすくするためにpprintモジュールを利用します
- **注意**：Google Driveに多くのファイルがある場合処理に時間がかかります

```py
import glob, pprint

files = glob.glob('/content/drive/MyDrive/**', recursive = True)

pprint.pprint(files)
```

---

# フォルダを作成する

- プログラムでフォルダを作成します
  - 特定の命名規則に従ってフォルダ生成
  - 大量のフォルダを生成
  - いろんな業務上で役に立つ

---

# フォルダを作成する

- フォルダを作成します
- `makedirs()`関数
  - 第1引数：作成するフォルダ名
  - 第2引数：「`exist_ok=True`」とすることですでに作成されていてもエラーが発生しない

### 実行例

```py
os.makedirs('file-name', exist_ok = True)
```

---

# フォルダを作成する

- フォルダを作成します
- `makedirs()`関数

```py
import os

os.makedirs('tmp', exist_ok = True)

print(os.listdir('.'))
```

---

# ファイルの書き込みと読み込み

- `open()`関数
  - Pythonに標準で用意されている関数
  - 引数
    - ***file***：ファイル名
    - ***mode***：モードオプション
    - ***encoding***：エンコードオプション
    - ***newline***：改行オプションなど

### `open()`関数の使用例

```py
open(file, mode='r', encoding=None, newline=None)
```

詳細：https://docs.python.org/ja/3/library/functions.html#open

---

# ファイルの書き込みと読み込み

- `open()`関数
  - 引数
    - ***file***
      - 作成するファイルの名前
      - ファイルの作成する場所をパスで指定
      - 例：`./file.txt`（カレントディレクトリに「file.txt」を作成）

### `open()`関数の使用例

```py
open('file.txt', ...)
```

---

# ファイルの書き込みと読み込み

- `open()`関数
  - 引数 
    - ***mode***
    - ファイルが開かれる際のモードを指定するオブションです
    - デフォルトでは`'r'`で，読み込み用に開きます
    - 読み込むためなのか，書き込むためなのか，新規作成なのかを決めます

### `open()`関数の使用例

```py
open('file.txt', mode='r', ...)
```

---

# ファイルの書き込みと読み込み

- `open()`関数 - 引数 - ***mode***オプション（一部）

| モード |                                解説                                |
| ------ | ------------------------------------------------------------------ |
| `r`    | 読み込み用に開く（デフォルトのモード）                             |
| `w`    | 書き込み用に開き，ファイルが存在する場合は内容を破棄して上書きする |
| `x`    | 生成用に開き，ファイルが存在する場合は失敗する                     |
| `a`    | 書き込み用に開き，ファイルが存在する場合は末尾に追記する           |
| `b`    | バイナリモードで開く（画像などのファイル読み込み時に使用）※1      |

※1：他のモードと組み合わせて，`rb`や`wb`のように使う

---

# ファイルの書き込みと読み込み

- `open()`関数
  - 引数
    - ***encoding***：エンコードオプション
      - テキストエンコーディングとは，文字や記号などをデジタルデータとして保存するための方法です
      - デフォルトは`None`
      - いろんな規格があります
      - **UTF-8**, **Shift-JIS**など
      - Google Colabは**UTF-8**です

### `open()`関数の使用例

```py
open('file.txt', mode='r', encoding='UTF-8',...)
```

---

# ファイルの書き込みと読み込み

- `open()`関数
  - 引数
    - ***newline***：オプション
      - 改行コードの制御
      - デフォルトは`None`
      - 詳細は後ほど

### `open()`関数の使用例

```py
open('file.txt', mode='r', encoding='UTF-8', newline=None, ...)
```

---

# ファイルの書き込みと読み込み

- `with`ブロック
  - 開始時と終了時の処理をセットで実行するPythonの構文
  - `open()`でファイルを開いたら，ファイルを閉じる処理`close()`を行う必要があります
  - `with`ブロックを使うことで，ブロックの終了時に自動的にクローズ処理をおこないます
  - 「`with open(...) as 変数：`」
    - 変数はファイルオブジェクト
    - 変数名は任意，一般的にfileの頭文字の「`f`」がよく使います

---

# ファイルの書き込みと読み込み

- ファイルオブジェクト
  - Pythonでファイル操作する際に使用するオブジェクト
  - `write()`メソッド
    - 開いたファイルに書き込むメソッド
    - 引数に書き込み内容を渡します
  - `read()`メソッド
    - `open()`関数で開いたファイルを読み込みます 
    - デフォルトの読み込みモード「`r`」

---

# ファイルの書き込みと読み込み

- ファイルの作成と書き込み
  - `open()`関数，`with`ブロック，`write()`メソッド
    - カレントディレクトリに「**file.txt**」ファイルをモード「**x**」で開きます
    - `with`ブロックでクローズ処理します
    - `write()`メソッドで「**file.txt**」に「**sample text**」と書き込みます
    - インデントに注意！！

```py
with open ('./file.txt', 'x') as f:
  f.write('sameple text')
```

---

# ファイルの書き込みと読み込み

- ファイルを開き，内容を読み込む
- `open()`関数，`with`ブロック，`read()`メソッド
  - カレントディレクトリにある「**file.txt**」ファイルを開きます
  - `with`ブロックでクローズ処理します
  - `read()`メソッドで「**file.txt**」の内容を読み込みます

```py
with open('./file.txt') as f:
  text = f.read()
  print(text)
```

---

# ファイルの移動

- ファイルの移動
- 「**file.txt**」を「**tmp**」フォルダに移動することを体験します

(画像を挿入する)

---

# ファイルの移動

- `shutil`モジュールを利用します
  - インストール済み，インポート必要
  - `move()` 関数
    - 第1引数：移動対象となるファイルパス
    - 第2引数：移動先のフォルダパス
    - 第1引数はファイルそのもので，第2引数は移動先のフォルダへのパスになります

### `move()`関数の使用例
`dir1`フォルダにある`file.txt`を`dir1`フォルダ内にある`dir2`フォルダに移動

```py
shutil.move('dir1/file.txt', 'dir1/dir2')
```

---

# ファイルの移動

- 「**file.txt**」を「**tmp**」フォルダに移動します
- `shutil`モジュールの`move()`関数を使用します

```py
import shutil

new_path = shutil.move('./file.txt', 'tmp/')

print(new_path)
```

---

# ファイルのコピー

- ファイルをコピーする方法を学びます
- `shutil`モジュールの`copy()`関数を利用します
  - 第1引数：コピー対象となるファイルパス
  - 第2引数：コピーしたファイルを作成する場所のパス

### `copy()`関数の使用例
`dir1`フォルダにある`file.txt`を`dir1`フォルダ内にある`dir2`フォルダにコピー
```py
shutil.copy('dir1/file.txt', 'dir1/dir2')
```

---

# ファイルのコピー

- 「**tmp/file.txt**」をコピーしてカレントディレクトリに作成する
- `shutil`モジュールの`copy()`関数

```py
import shutil

shutil.copy('tmp/file.txt', './')
```

---

# フォルダのコピー

- フォルダをコピーする方法を学びます
- `shutil`モジュールの`copytree()`関数を利用します
  - フォルダ内の中身ごとコピーすることができます
  - 第1引数：コピー対象となるフォルダパス
  - 第2引数：コピーしたフォルダを作成する場所のパス
  - 第2引数はフォルダの新規作成も可能です

---

# フォルダのコピー

- フォルダのコピー
- 「**tmp**」フォルダのコピーしてカレントディレクトリに「**tmp-copy**」フォルダを作成します
- `shutil`モジュールの`copytree()`関数を利用する

```py
import shutil

shutil.copytree('tmp', 'tmp-copy')
```

---

# ファイル名の変更

- ファイル名の変更する方法を学びます
- `os`モジュールの`rename()`関数を利用します
  - 第1引数：名前変更対象となるファイルパス
  - 第2引数：変更後の名前とパス

---

# ファイル名の変更

- ファイル名の変更する方法を学びます
- 「**file.txt**」を「**file2.txt**」に変更します
- `os`モジュールの`rename()`関数を利用します

```py
import os

os.rename('tmp/file.txt', 'tmp/file2.txt')
```

---

# 課題

---

# 課題

- Moodleにある「SCfCL-8th-prac.ipynb」ファイルをダウンロードしてColabにアップロードしてください
- 課題が完了したら「File」>「Download」>「Download .ipynb」で「.ipynb」形式でダウンロードしてください
- ダウンロードした **.ipynbファイル** をMoodleに提出してください
- 提出期限は **6月13日(木) 20時まで** です
